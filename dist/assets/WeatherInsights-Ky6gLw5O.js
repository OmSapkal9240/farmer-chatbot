import{r as p,j as t}from"./index-SuqBYE3h.js";import{W as R}from"./WeatherCard-DsDt1gCR.js";const E="https://geocoding-api.open-meteo.com/v1/search",F="https://api.open-meteo.com/v1/forecast",O={lat:18.5204,lon:73.8567,name:"Pune, IN"},g={mock:!0,name:"Demo Farm",current:{temp:29,weather:"Partly cloudy",wind_kmh:12,humidity:62},daily:[{date:"2025-12-06",min:21,max:30,pop:.1},{date:"2025-12-07",min:20,max:31,pop:.05},{date:"2025-12-08",min:22,max:32,pop:.6}]};async function w(l){const n=await fetch(l);if(!n.ok)throw new Error(`Network error ${n.status}`);return n.json()}async function S(l){try{const n=encodeURIComponent(l),c=`${E}?name=${n}&count=1&language=en&format=json`,e=await w(c);if(!e||!e.results||e.results.length===0)return{error:"NOT_FOUND",message:"Location not found"};const s=e.results[0];return{lat:s.latitude,lon:s.longitude,name:s.name+(s.country?", "+s.country:"")}}catch(n){return console.warn("Geocode error:",n.message),{error:"GEO_ERROR",message:n.message,mock:!0,...O}}}async function L(l,n){try{const c=`${F}?latitude=${l}&longitude=${n}&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_mean,precipitation_sum&current_weather=true&timezone=auto`,e=await w(c);if(!e)throw new Error("No data");const s=e.current_weather||{},u={temp:s.temperature??e.daily?.temperature_2m_max?.[0]??null,wind_kmh:s.windspeed?Math.round(s.windspeed*3.6):null,weather:s?.weathercode??null},o=(e.daily?.time||[]).map((x,d)=>({date:e.daily.time[d],min:e.daily.temperature_2m_min[d],max:e.daily.temperature_2m_max[d],pop:e.daily.precipitation_probability_mean&&e.daily.precipitation_probability_mean[d]!==void 0?e.daily.precipitation_probability_mean[d]/100:e.daily.precipitation_sum&&e.daily.precipitation_sum[d]>0?.8:0}));return{name:e.timezone??`${l},${n}`,current:u,daily:o}}catch(c){return console.warn("Forecast error:",c.message),{error:"FORECAST_ERROR",message:c.message,mock:!0,...g}}}async function b(l,n,c=null){const e=await L(l,n);return e.error&&e.mock?{mock:!0,name:e.name||g.name,daily:g.daily.slice(0,3)}:{mock:!1,name:c||e.name,daily:(e.daily||[]).slice(0,3),current:e.current}}function $(l,n,c){return n>35?"High heat—irrigate morning/evening":c>.4?"Rain expected—postpone spraying":"Normal — monitor crop"}function q(){const[l,n]=p.useState(""),[c,e]=p.useState(!1),[s,u]=p.useState(null),[o,x]=p.useState(null),[d,_]=p.useState(()=>{try{return JSON.parse(localStorage.getItem("recentWeather")||"[]")}catch{return[]}}),[y,h]=p.useState(!1);p.useEffect(()=>{},[]);async function N(r){u(null),e(!0);try{const a=await S(r);if(a.error){u(a.message||"Location not found"),e(!1);return}const i=await b(a.lat,a.lon,a.name);i.error&&i.mock?(h(!0),x(i)):(h(!1),x({name:a.name,...i}));const m=[{q:a.name,lat:a.lat,lon:a.lon},...d.filter(f=>f.q!==a.name)].slice(0,5);_(m),localStorage.setItem("recentWeather",JSON.stringify(m))}catch(a){u(a.message||"Failed to load")}finally{e(!1)}}async function k(){if(u(null),e(!0),!navigator.geolocation){u("Geolocation not supported"),e(!1);return}navigator.geolocation.getCurrentPosition(async r=>{try{const a=r.coords.latitude,i=r.coords.longitude,m=await b(a,i,null);m.error&&m.mock?(h(!0),x(m)):(h(!1),x({name:m.name||`${a.toFixed(2)},${i.toFixed(2)}`,...m}))}catch(a){u(a.message||"Failed to load")}finally{e(!1)}},r=>{u("Location permission denied or unavailable"),e(!1)})}function C(r){n(r.q),N(r.q)}function j(r,a){if(!r&&!a)return null;const i=[],m=r?.temp??a?.[0]?.max,f=r?.humidity??null,v=r?.wind_kmh??null;return m>35&&i.push("High heat: irrigate in morning/evening; avoid midday spraying."),f&&f>80&&i.push("High humidity: avoid spraying; fungal risk."),v&&v>8&&i.push("High wind: delay spraying."),a&&a[0]&&a[0].pop>.4&&i.push("Rain likely: postpone fertiliser & spraying."),i}return t.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-10",children:[t.jsx("h2",{className:"text-3xl font-extrabold",style:{fontFamily:"'Orbitron', sans-serif"},children:"Weather Insights"}),t.jsxs("div",{className:"mt-6 flex gap-3 items-center",children:[t.jsx("input",{value:l,onChange:r=>n(r.target.value),placeholder:"Enter city or PIN code",className:"flex-grow px-4 py-3 rounded-full bg-[#0b1220] border border-slate-700"}),t.jsx("button",{onClick:()=>N(l),className:"px-4 py-3 rounded-full bg-gradient-to-r from-emerald-400 to-cyan-400 font-semibold",children:"Search"}),t.jsx("button",{onClick:k,className:"px-4 py-3 rounded-full bg-slate-700",children:"Use My Location"})]}),t.jsxs("div",{className:"mt-4 flex gap-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-slate-400",children:"Recent"}),t.jsxs("div",{className:"flex gap-2 mt-2",children:[d.length===0&&t.jsx("div",{className:"text-slate-500",children:"No recent"}),d.map((r,a)=>t.jsx("button",{onClick:()=>C(r),className:"px-3 py-1 rounded-full bg-slate-800/50 text-sm",children:r.q},a))]})]}),t.jsx("div",{className:"ml-auto",children:t.jsx("button",{onClick:()=>{h(!y),y&&x(null)},className:"text-sm px-3 py-1 rounded-full bg-slate-800/40",children:y?"Demo ON":"Toggle Demo"})})]}),c&&t.jsx("div",{className:"mt-8 text-slate-400",children:"Loading…"}),s&&t.jsx("div",{className:"mt-6 text-red-400",children:s}),o&&t.jsxs("section",{className:"mt-8 grid gap-6",children:[t.jsx("div",{className:"p-6 rounded-2xl bg-slate-900/60 border border-slate-700",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-slate-400 text-sm",children:"Location"}),t.jsx("div",{className:"text-xl font-bold",children:o.name})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-5xl font-extrabold",children:[o.current?Math.round(o.current.temp):Math.round(o.daily[0].max),"°"]}),t.jsx("div",{className:"text-sm text-slate-400",children:o.current?.weather??"—"})]})]})}),t.jsx("div",{className:"flex gap-4 overflow-x-auto",children:(o.daily||[]).slice(0,3).map((r,a)=>t.jsx(R,{date:r.date,min:r.min,max:r.max,pop:r.pop,tip:$(r.min,r.max,r.pop)},a))}),t.jsxs("div",{className:"p-4 rounded-2xl bg-slate-800/50 border border-slate-700",children:[t.jsx("div",{className:"font-semibold",children:"Farming Advice"}),t.jsx("ul",{className:"list-disc list-inside mt-2 text-slate-300",children:j(o.current,o.daily)?.length?j(o.current,o.daily).map((r,a)=>t.jsx("li",{children:r},a)):t.jsx("li",{children:"All good — monitor conditions."})})]})]})]})}export{q as default};
