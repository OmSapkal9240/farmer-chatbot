import{c as g,r as m,j as e,X as w}from"./index-SuqBYE3h.js";const N=g("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]),v=g("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),k=g("UploadCloud",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m16 16-4-4-4 4",key:"119tzi"}]]),P=({text:t})=>{if(!t||!t.trim())return e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-yellow-400 mb-2",children:"Analysis Complete"}),e.jsx("p",{className:"text-gray-300",children:"The analysis did not return a specific diagnosis. This may be due to image quality or the AI's content safety filters. Please try a different image."})]});const i=t.split(/(Diagnosis:|Treatment Options:)/).filter(Boolean),o=[];for(let s=0;s<i.length;s+=2){const a=i[s],n=i[s+1];a&&n&&o.push({title:a.trim(),content:n.trim()})}return o.length===0?e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-green-400 mb-2",children:"Diagnosis Result"}),e.jsx("p",{className:"text-gray-300 whitespace-pre-wrap",children:t})]}):e.jsx("div",{className:"space-y-4 text-left",children:o.map(({title:s,content:a})=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-green-400 mb-2",children:s}),e.jsx("p",{className:"text-gray-300 whitespace-pre-wrap",children:a})]},s))})},D=()=>{const[t,i]=m.useState(null),[o,s]=m.useState(""),[a,n]=m.useState(""),[x,u]=m.useState(!1),[h,d]=m.useState(""),y=p=>{const l=p.target.files[0];l&&(i(l),s(URL.createObjectURL(l)),n(""),d(""))},f=()=>{i(null),s(""),n(""),d("")},j=async p=>{if(p.preventDefault(),!t){d("Please select an image first.");return}u(!0),d(""),n("");const l=new FormData;l.append("image",t);try{const r=await fetch("http://localhost:3000/api/diagnose",{method:"POST",body:l});if(!r.ok){const b=await r.text();throw new Error(`HTTP error! Status: ${r.status}. Server response: ${b}`)}console.log("API response received:",r);const c=await r.json();if(console.log("Parsed JSON data:",c),c.error)throw console.error("API returned an error:",c.error),new Error(c.error);console.log("Setting diagnosis state with:",c.diagnosis),n(c.diagnosis)}catch(r){console.error("Diagnosis error:",r),d(`Failed to get diagnosis. ${r.message}`)}finally{u(!1)}};return e.jsxs("div",{className:"min-h-[calc(100vh-200px)] container mx-auto p-4 md:p-6 text-white",children:[e.jsxs("header",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-green-400",children:"Pest & Disease Diagnosis"}),e.jsx("p",{className:"text-gray-400 mt-2 max-w-2xl mx-auto",children:"Upload an image of the affected crop to get an instant AI-powered diagnosis and treatment recommendation."})]}),e.jsxs("div",{className:"max-w-4xl mx-auto bg-slate-800/50 rounded-2xl p-6 md:p-8 border border-slate-700",children:[e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"image-upload",className:"block text-sm font-medium text-gray-300 mb-2",children:"Crop Image"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-slate-600 border-dashed rounded-md",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(k,{className:"mx-auto h-12 w-12 text-slate-500"}),e.jsxs("div",{className:"flex text-sm text-slate-400",children:[e.jsxs("label",{htmlFor:"image-upload",className:"relative cursor-pointer bg-slate-700 rounded-md font-medium text-green-400 hover:text-green-300 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-offset-slate-800 focus-within:ring-green-500 px-2",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"image-upload",name:"image-upload",type:"file",className:"sr-only",accept:"image/*",onChange:y})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG, GIF up to 10MB"})]})})]}),o&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:o,alt:"Preview",className:"mt-4 rounded-lg max-h-80 mx-auto"}),e.jsx("button",{type:"button",onClick:f,className:"absolute top-2 right-2 p-1.5 bg-black/60 rounded-full text-white hover:bg-black/80 transition-opacity opacity-0 group-hover:opacity-100",children:e.jsx(w,{size:18})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"submit",disabled:!t||x,className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-green-500 disabled:bg-slate-600 disabled:cursor-not-allowed transition-colors",children:x?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"animate-spin -ml-1 mr-3 h-5 w-5"})," Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"-ml-1 mr-2 h-5 w-5"})," Diagnose Pest"]})})})]}),(x||h||a)&&e.jsxs("div",{className:"mt-8 pt-6 border-t border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-4",children:"Analysis Status"}),e.jsxs("div",{className:"bg-slate-900/70 p-4 rounded-lg text-left",children:[x&&e.jsx("p",{className:"text-yellow-400",children:"Analyzing image, please wait..."}),h&&e.jsxs("p",{className:"text-red-400 whitespace-pre-wrap",children:[e.jsx("b",{children:"Error:"})," ",h]}),a&&e.jsxs("div",{children:[e.jsx("p",{className:"text-green-400 font-bold mb-4",children:"Success! Diagnosis complete."}),e.jsx(P,{text:a})]})]})]})]})]})};export{D as default};
